var nr={},ir=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function sr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function ar(i,e,t){return t={path:e,exports:{},require:function(r,n){return or(r,n??t.path)}},i(t,t.exports),t.exports}function or(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var cr=ar(function(i,e){var t=typeof self!="undefined"?self:ir,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){var a=function(l){var o={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch(u){return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function d(u){return u&&DataView.prototype.isPrototypeOf(u)}if(o.arrayBuffer)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],m=ArrayBuffer.isView||function(u){return u&&c.indexOf(Object.prototype.toString.call(u))>-1};function S(u){if(typeof u!="string"&&(u=String(u)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function P(u){return typeof u!="string"&&(u=String(u)),u}function D(u){var p={next:function(){var g=u.shift();return{done:g===void 0,value:g}}};return o.iterable&&(p[Symbol.iterator]=function(){return p}),p}function k(u){this.map={},u instanceof k?u.forEach(function(p,g){this.append(g,p)},this):Array.isArray(u)?u.forEach(function(p){this.append(p[0],p[1])},this):u&&Object.getOwnPropertyNames(u).forEach(function(p){this.append(p,u[p])},this)}k.prototype.append=function(u,p){u=S(u),p=P(p);var g=this.map[u];this.map[u]=g?g+", "+p:p},k.prototype.delete=function(u){delete this.map[S(u)]},k.prototype.get=function(u){return u=S(u),this.has(u)?this.map[u]:null},k.prototype.has=function(u){return this.map.hasOwnProperty(S(u))},k.prototype.set=function(u,p){this.map[S(u)]=P(p)},k.prototype.forEach=function(u,p){for(var g in this.map)this.map.hasOwnProperty(g)&&u.call(p,this.map[g],g,this)},k.prototype.keys=function(){var u=[];return this.forEach(function(p,g){u.push(g)}),D(u)},k.prototype.values=function(){var u=[];return this.forEach(function(p){u.push(p)}),D(u)},k.prototype.entries=function(){var u=[];return this.forEach(function(p,g){u.push([g,p])}),D(u)},o.iterable&&(k.prototype[Symbol.iterator]=k.prototype.entries);function te(u){if(u.bodyUsed)return Promise.reject(new TypeError("Already read"));u.bodyUsed=!0}function ue(u){return new Promise(function(p,g){u.onload=function(){p(u.result)},u.onerror=function(){g(u.error)}})}function U(u){var p=new FileReader,g=ue(p);return p.readAsArrayBuffer(u),g}function W(u){var p=new FileReader,g=ue(p);return p.readAsText(u),g}function he(u){for(var p=new Uint8Array(u),g=new Array(p.length),x=0;x<p.length;x++)g[x]=String.fromCharCode(p[x]);return g.join("")}function K(u){if(u.slice)return u.slice(0);var p=new Uint8Array(u.byteLength);return p.set(new Uint8Array(u)),p.buffer}function X(){return this.bodyUsed=!1,this._initBody=function(u){this._bodyInit=u,u?typeof u=="string"?this._bodyText=u:o.blob&&Blob.prototype.isPrototypeOf(u)?this._bodyBlob=u:o.formData&&FormData.prototype.isPrototypeOf(u)?this._bodyFormData=u:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)?this._bodyText=u.toString():o.arrayBuffer&&o.blob&&d(u)?(this._bodyArrayBuffer=K(u.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(u)||m(u))?this._bodyArrayBuffer=K(u):this._bodyText=u=Object.prototype.toString.call(u):this._bodyText="",this.headers.get("content-type")||(typeof u=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(u)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var u=te(this);if(u)return u;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?te(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(U)}),this.text=function(){var u=te(this);if(u)return u;if(this._bodyBlob)return W(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(he(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(me)}),this.json=function(){return this.text().then(JSON.parse)},this}var A=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function j(u){var p=u.toUpperCase();return A.indexOf(p)>-1?p:u}function M(u,p){p=p||{};var g=p.body;if(u instanceof M){if(u.bodyUsed)throw new TypeError("Already read");this.url=u.url,this.credentials=u.credentials,p.headers||(this.headers=new k(u.headers)),this.method=u.method,this.mode=u.mode,this.signal=u.signal,!g&&u._bodyInit!=null&&(g=u._bodyInit,u.bodyUsed=!0)}else this.url=String(u);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new k(p.headers)),this.method=j(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&g)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(g)}M.prototype.clone=function(){return new M(this,{body:this._bodyInit})};function me(u){var p=new FormData;return u.trim().split("&").forEach(function(g){if(g){var x=g.split("="),_=x.shift().replace(/\+/g," "),v=x.join("=").replace(/\+/g," ");p.append(decodeURIComponent(_),decodeURIComponent(v))}}),p}function ye(u){var p=new k,g=u.replace(/\r?\n[\t ]+/g," ");return g.split(/\r?\n/).forEach(function(x){var _=x.split(":"),v=_.shift().trim();if(v){var H=_.join(":").trim();p.append(v,H)}}),p}X.call(M.prototype);function R(u,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new k(p.headers),this.url=p.url||"",this._initBody(u)}X.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new k(this.headers),url:this.url})},R.error=function(){var u=new R(null,{status:0,statusText:""});return u.type="error",u};var B=[301,302,303,307,308];R.redirect=function(u,p){if(B.indexOf(p)===-1)throw new RangeError("Invalid status code");return new R(null,{status:p,headers:{location:u}})},l.DOMException=s.DOMException;try{new l.DOMException}catch(u){l.DOMException=function(p,g){this.message=p,this.name=g;var x=Error(p);this.stack=x.stack},l.DOMException.prototype=Object.create(Error.prototype),l.DOMException.prototype.constructor=l.DOMException}function N(u,p){return new Promise(function(g,x){var _=new M(u,p);if(_.signal&&_.signal.aborted)return x(new l.DOMException("Aborted","AbortError"));var v=new XMLHttpRequest;function H(){v.abort()}v.onload=function(){var G={status:v.status,statusText:v.statusText,headers:ye(v.getAllResponseHeaders()||"")};G.url="responseURL"in v?v.responseURL:G.headers.get("X-Request-URL");var z="response"in v?v.response:v.responseText;g(new R(z,G))},v.onerror=function(){x(new TypeError("Network request failed"))},v.ontimeout=function(){x(new TypeError("Network request failed"))},v.onabort=function(){x(new l.DOMException("Aborted","AbortError"))},v.open(_.method,_.url,!0),_.credentials==="include"?v.withCredentials=!0:_.credentials==="omit"&&(v.withCredentials=!1),"responseType"in v&&o.blob&&(v.responseType="blob"),_.headers.forEach(function(G,z){v.setRequestHeader(z,G)}),_.signal&&(_.signal.addEventListener("abort",H),v.onreadystatechange=function(){v.readyState===4&&_.signal.removeEventListener("abort",H)}),v.send(typeof _._bodyInit=="undefined"?null:_._bodyInit)})}return N.polyfill=!0,s.fetch||(s.fetch=N,s.Headers=k,s.Request=M,s.Response=R),l.Headers=k,l.Request=M,l.Response=R,l.fetch=N,Object.defineProperty(l,"__esModule",{value:!0}),l}({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var n=r;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,i.exports=e}),Ye=sr(cr),be=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},lr=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),ur=(i,e)=>{if(typeof i.json!="function")return e(i);i.json().then(t=>e({message:lr(t),status:(i==null?void 0:i.status)||500}))},hr=(i,e,t)=>{let r={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||(r.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(t)),r};function Ue(i,e,t,r){return be(this,void 0,void 0,function*(){return new Promise((n,s)=>{Ye(e,hr(i,t,r)).then(a=>{if(!a.ok)throw a;return(t==null?void 0:t.noResolveJson)?n:a.json()}).then(a=>n(a)).catch(a=>ur(a,s))})})}function dr(i,e){return be(this,void 0,void 0,function*(){return Ue("GET",i,e)})}function ne(i,e,t){return be(this,void 0,void 0,function*(){return Ue("POST",i,t,e)})}function fr(i,e,t){return be(this,void 0,void 0,function*(){return Ue("PUT",i,t,e)})}function pr(i,e,t){return be(this,void 0,void 0,function*(){return Ue("DELETE",i,t,e)})}var mr="http://localhost:9999",yr={},qe="supabase.auth.token",gr={name:"sb:token",lifetime:60*60*8,domain:"",path:"/",sameSite:"lax"};function vr(i,e,t){let r=t||{},n=encodeURIComponent,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!s.test(i))throw new TypeError("argument name is invalid");let a=n(e);if(a&&!s.test(a))throw new TypeError("argument val is invalid");let l=i+"="+a;if(r.maxAge!=null){let o=r.maxAge-0;if(isNaN(o)||!isFinite(o))throw new TypeError("option maxAge is invalid");l+="; Max-Age="+Math.floor(o)}if(r.domain){if(!s.test(r.domain))throw new TypeError("option domain is invalid");l+="; Domain="+r.domain}if(r.path){if(!s.test(r.path))throw new TypeError("option path is invalid");l+="; Path="+r.path}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");l+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(l+="; HttpOnly"),r.secure&&(l+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;case"none":l+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return l}function br(i){if(!i||!i.headers||!i.headers.host)throw new Error('The "host" request header is not available');let e=i.headers.host.indexOf(":")>-1&&i.headers.host.split(":")[0]||i.headers.host;return!(["localhost","127.0.0.1"].indexOf(e)>-1||e.endsWith(".local"))}function wr(i,e){var t,r,n;return vr(i.name,i.value,{maxAge:i.maxAge,expires:new Date(Date.now()+i.maxAge*1e3),httpOnly:!0,secure:e,path:(t=i.path)!==null&&t!==void 0?t:"/",domain:(r=i.domain)!==null&&r!==void 0?r:"",sameSite:(n=i.sameSite)!==null&&n!==void 0?n:"lax"})}function _r(i,e,t){let r=t.map(s=>wr(s,br(i))),n=e.getHeader("Set-Cookie");n&&(n instanceof Array?Array.prototype.push.apply(r,n):typeof n=="string"&&r.push(n)),e.setHeader("Set-Cookie",r)}function ot(i,e,t){_r(i,e,[t])}function kr(i,e,t){ot(i,e,{name:t,value:"",maxAge:-1})}function We(i){return Math.round(Date.now()/1e3)+i}function xr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var e=Math.random()*16|0,t=i=="x"?e:e&3|8;return t.toString(16)})}var ie=()=>typeof window!="undefined";function Q(i,e){e||(e=window.location.href),i=i.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&#]"+i+"(=([^&#]*)|&|#|$)"),r=t.exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var at=class{constructor(e){this.localStorage=e||globalThis.localStorage}clear(){return this.localStorage.clear()}key(e){return this.localStorage.key(e)}setItem(e,t){return this.localStorage.setItem(e,t)}getItem(e){return this.localStorage.getItem(e)}removeItem(e){return this.localStorage.removeItem(e)}},L=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},ct=class{constructor({url:e="",headers:t={},cookieOptions:r}){this.url=e,this.headers=t,this.cookieOptions=Object.assign(Object.assign({},gr),r)}signUpWithEmail(e,t,r={}){return L(this,void 0,void 0,function*(){try{let n=Object.assign({},this.headers),s="";r.redirectTo&&(s="?redirect_to="+r.redirectTo);let a=yield ne(`${this.url}/signup${s}`,{email:e,password:t},{headers:n}),l=Object.assign({},a);return l.expires_in&&(l.expires_at=We(a.expires_in)),{data:l,error:null}}catch(n){return{data:null,error:n}}})}signInWithEmail(e,t,r={}){return L(this,void 0,void 0,function*(){try{let n=Object.assign({},this.headers),s="?grant_type=password";r.redirectTo&&(s+="&redirect_to="+r.redirectTo);let a=yield ne(`${this.url}/token${s}`,{email:e,password:t},{headers:n}),l=Object.assign({},a);return l.expires_in&&(l.expires_at=We(a.expires_in)),{data:l,error:null}}catch(n){return{data:null,error:n}}})}sendMagicLinkEmail(e,t={}){return L(this,void 0,void 0,function*(){try{let r=Object.assign({},this.headers),n="";return t.redirectTo&&(n+="?redirect_to="+t.redirectTo),{data:yield ne(`${this.url}/magiclink${n}`,{email:e},{headers:r}),error:null}}catch(r){return{data:null,error:r}}})}inviteUserByEmail(e,t={}){return L(this,void 0,void 0,function*(){try{let r=Object.assign({},this.headers),n="";return t.redirectTo&&(n+="?redirect_to="+t.redirectTo),{data:yield ne(`${this.url}/invite${n}`,{email:e},{headers:r}),error:null}}catch(r){return{data:null,error:r}}})}resetPasswordForEmail(e,t={}){return L(this,void 0,void 0,function*(){try{let r=Object.assign({},this.headers),n="";return t.redirectTo&&(n+="?redirect_to="+t.redirectTo),{data:yield ne(`${this.url}/recover${n}`,{email:e},{headers:r}),error:null}}catch(r){return{data:null,error:r}}})}_createRequestHeaders(e){let t=Object.assign({},this.headers);return t.Authorization=`Bearer ${e}`,t}signOut(e){return L(this,void 0,void 0,function*(){try{return yield ne(`${this.url}/logout`,{},{headers:this._createRequestHeaders(e),noResolveJson:!0}),{error:null}}catch(t){return{error:t}}})}getUrlForProvider(e,t){let r=[`provider=${e}`];return(t==null?void 0:t.redirectTo)&&r.push(`redirect_to=${t.redirectTo}`),(t==null?void 0:t.scopes)&&r.push(`scopes=${t.scopes}`),`${this.url}/authorize?${r.join("&")}`}getUser(e){return L(this,void 0,void 0,function*(){try{let t=yield dr(`${this.url}/user`,{headers:this._createRequestHeaders(e)});return{user:t,data:t,error:null}}catch(t){return{user:null,data:null,error:t}}})}updateUser(e,t){return L(this,void 0,void 0,function*(){try{let r=yield fr(`${this.url}/user`,t,{headers:this._createRequestHeaders(e)});return{user:r,data:r,error:null}}catch(r){return{user:null,data:null,error:r}}})}deleteUser(e,t){return L(this,void 0,void 0,function*(){try{let r=yield pr(`${this.url}/admin/users/${e}`,{},{headers:this._createRequestHeaders(t)});return{user:r,data:r,error:null}}catch(r){return{user:null,data:null,error:r}}})}refreshAccessToken(e){return L(this,void 0,void 0,function*(){try{let t=yield ne(`${this.url}/token?grant_type=refresh_token`,{refresh_token:e},{headers:this.headers}),r=Object.assign({},t);return r.expires_in&&(r.expires_at=We(t.expires_in)),{data:r,error:null}}catch(t){return{data:null,error:t}}})}setAuthCookie(e,t){e.method!=="POST"&&(t.setHeader("Allow","POST"),t.status(405).end("Method Not Allowed"));let{event:r,session:n}=e.body;if(!r)throw new Error("Auth event missing!");if(r==="SIGNED_IN"){if(!n)throw new Error("Auth session missing!");ot(e,t,{name:this.cookieOptions.name,value:n.access_token,domain:this.cookieOptions.domain,maxAge:this.cookieOptions.lifetime,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite})}r==="SIGNED_OUT"&&kr(e,t,this.cookieOptions.name),t.status(200).json({})}getUserByCookie(e){return L(this,void 0,void 0,function*(){try{if(!e.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");if(!e.cookies[this.cookieOptions.name])throw new Error("No cookie found!");let t=e.cookies[this.cookieOptions.name],{user:r,error:n}=yield this.getUser(t);if(n)throw n;return{user:r,data:r,error:null}}catch(t){return{user:null,data:null,error:t}}})}};function $r(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(i){typeof self!="undefined"&&(self.globalThis=self)}}var F=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})};$r();var Er={url:mr,autoRefreshToken:!0,persistSession:!0,localStorage:globalThis.localStorage,detectSessionInUrl:!0,headers:yr},lt=class{constructor(e){this.stateChangeEmitters=new Map;let t=Object.assign(Object.assign({},Er),e);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=t.autoRefreshToken,this.persistSession=t.persistSession,this.localStorage=new at(t.localStorage),this.api=new ct({url:t.url,headers:t.headers,cookieOptions:t.cookieOptions}),this._recoverSession(),this._recoverAndRefresh();try{t.detectSessionInUrl&&ie()&&!!Q("access_token")&&this.getSessionFromUrl({storeSession:!0})}catch(r){console.log("Error getting session from URL.")}}signUp({email:e,password:t},r={}){return F(this,void 0,void 0,function*(){try{this._removeSession();let{data:n,error:s}=yield this.api.signUpWithEmail(e,t,{redirectTo:r.redirectTo});if(s)throw s;if(!n)throw"An error occurred on sign up.";let a=null,l=null;return n.access_token&&(a=n,l=a.user,this._saveSession(a),this._notifyAllSubscribers("SIGNED_IN")),n.id&&(l=n),{data:n,user:l,session:a,error:null}}catch(n){return{data:null,user:null,session:null,error:n}}})}signIn({email:e,password:t,refreshToken:r,provider:n},s={}){return F(this,void 0,void 0,function*(){try{if(this._removeSession(),e&&!t){let{error:a}=yield this.api.sendMagicLinkEmail(e,{redirectTo:s.redirectTo});return{data:null,user:null,session:null,error:a}}if(e&&t)return this._handleEmailSignIn(e,t,{redirectTo:s.redirectTo});if(r){let{error:a}=yield this._callRefreshToken(r);if(a)throw a;return{data:this.currentSession,user:this.currentUser,session:this.currentSession,error:null}}if(n)return this._handleProviderSignIn(n,{redirectTo:s.redirectTo,scopes:s.scopes});throw new Error("You must provide either an email or a third-party provider.")}catch(a){return{data:null,user:null,session:null,error:a}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var e;return F(this,void 0,void 0,function*(){try{if(!((e=this.currentSession)===null||e===void 0?void 0:e.access_token))throw new Error("Not logged in.");let{error:t}=yield this._callRefreshToken();if(t)throw t;return{data:this.currentSession,user:this.currentUser,error:null}}catch(t){return{data:null,user:null,error:t}}})}update(e){var t;return F(this,void 0,void 0,function*(){try{if(!((t=this.currentSession)===null||t===void 0?void 0:t.access_token))throw new Error("Not logged in.");let{user:r,error:n}=yield this.api.updateUser(this.currentSession.access_token,e);if(n)throw n;if(!r)throw Error("Invalid user data.");let s=Object.assign(Object.assign({},this.currentSession),{user:r});return this._saveSession(s),this._notifyAllSubscribers("USER_UPDATED"),{data:r,user:r,error:null}}catch(r){return{data:null,user:null,error:r}}})}setSession(e){return F(this,void 0,void 0,function*(){try{if(!e)throw new Error("No current session.");let{data:t,error:r}=yield this.api.refreshAccessToken(e);return r?{session:null,error:r}:t?(this._saveSession(t),this._notifyAllSubscribers("SIGNED_IN"),{session:t,error:null}):{session:null,error:{name:"Invalid refresh_token",message:"JWT token provided is Invalid"}}}catch(t){return{error:t,session:null}}})}setAuth(e){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:e,token_type:"bearer",user:null}),this.currentSession}getSessionFromUrl(e){return F(this,void 0,void 0,function*(){try{if(!ie())throw new Error("No browser detected.");let t=Q("error_description");if(t)throw new Error(t);let r=Q("provider_token"),n=Q("access_token");if(!n)throw new Error("No access_token detected.");let s=Q("expires_in");if(!s)throw new Error("No expires_in detected.");let a=Q("refresh_token");if(!a)throw new Error("No refresh_token detected.");let l=Q("token_type");if(!l)throw new Error("No token_type detected.");let d=Math.round(Date.now()/1e3)+parseInt(s),{user:c,error:m}=yield this.api.getUser(n);if(m)throw m;let S={provider_token:r,access_token:n,expires_in:parseInt(s),expires_at:d,refresh_token:a,token_type:l,user:c};return(e==null?void 0:e.storeSession)&&(this._saveSession(S),this._notifyAllSubscribers("SIGNED_IN"),Q("type")==="recovery"&&this._notifyAllSubscribers("PASSWORD_RECOVERY")),window.location.hash="",{data:S,error:null}}catch(t){return{data:null,error:t}}})}signOut(){var e;return F(this,void 0,void 0,function*(){let t=(e=this.currentSession)===null||e===void 0?void 0:e.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),t){let{error:r}=yield this.api.signOut(t);if(r)return{error:r}}return{error:null}})}onAuthStateChange(e){try{let t=xr(),r=this,n={id:t,callback:e,unsubscribe:()=>{r.stateChangeEmitters.delete(t)}};return this.stateChangeEmitters.set(t,n),{data:n,error:null}}catch(t){return{data:null,error:t}}}_handleEmailSignIn(e,t,r={}){var n;return F(this,void 0,void 0,function*(){try{let{data:s,error:a}=yield this.api.signInWithEmail(e,t,{redirectTo:r.redirectTo});return a||!s?{data:null,user:null,session:null,error:a}:(((n=s==null?void 0:s.user)===null||n===void 0?void 0:n.confirmed_at)&&(this._saveSession(s),this._notifyAllSubscribers("SIGNED_IN")),{data:s,user:s.user,session:s,error:null})}catch(s){return{data:null,user:null,session:null,error:s}}})}_handleProviderSignIn(e,t={}){let r=this.api.getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes});try{return ie()&&(window.location.href=r),{provider:e,url:r,data:null,session:null,user:null,error:null}}catch(n){return r?{provider:e,url:r,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:n}}}_recoverSession(){var e;try{let t=ie()&&((e=this.localStorage)===null||e===void 0?void 0:e.getItem(qe));if(!t||typeof t!="string")return null;let r=JSON.parse(t),{currentSession:n,expiresAt:s}=r,a=Math.round(Date.now()/1e3);s>=a&&(n==null?void 0:n.user)&&(this._saveSession(n),this._notifyAllSubscribers("SIGNED_IN"))}catch(t){console.log("error",t)}}_recoverAndRefresh(){return F(this,void 0,void 0,function*(){try{let e=ie()&&(yield this.localStorage.getItem(qe));if(!e)return null;let t=JSON.parse(e),{currentSession:r,expiresAt:n}=t,s=Math.round(Date.now()/1e3);if(n<s)if(this.autoRefreshToken&&r.refresh_token){let{error:a}=yield this._callRefreshToken(r.refresh_token);a&&(console.log(a.message),yield this._removeSession())}else this._removeSession();else!r||!r.user?(console.log("Current session is missing data."),this._removeSession()):(this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN"))}catch(e){return console.error(e),null}})}_callRefreshToken(e){var t;return e===void 0&&(e=(t=this.currentSession)===null||t===void 0?void 0:t.refresh_token),F(this,void 0,void 0,function*(){try{if(!e)throw new Error("No current session.");let{data:r,error:n}=yield this.api.refreshAccessToken(e);if(n)throw n;if(!r)throw Error("Invalid session data.");return this._saveSession(r),this._notifyAllSubscribers("SIGNED_IN"),{data:r,error:null}}catch(r){return{data:null,error:r}}})}_notifyAllSubscribers(e){this.stateChangeEmitters.forEach(t=>t.callback(e,this.currentSession))}_saveSession(e){this.currentSession=e,this.currentUser=e.user;let t=e.expires_at,r=Math.round(Date.now()/1e3);t&&this._startAutoRefreshToken((t-r-60)*1e3),this.persistSession&&e.expires_at&&this._persistSession(this.currentSession)}_persistSession(e){let t={currentSession:e,expiresAt:e.expires_at};ie()&&this.localStorage.setItem(qe,JSON.stringify(t))}_removeSession(){return F(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),ie()&&(yield this.localStorage.removeItem(qe))})}_startAutoRefreshToken(e){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),!(!e||!this.autoRefreshToken)&&(this.refreshTokenTimer=setTimeout(()=>this._callRefreshToken(),e))}},ut=class extends lt{constructor(e){super(e)}},Tr=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},Me=class{constructor(e){Object.assign(this,e)}then(e,t){return typeof this.schema=="undefined"||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json"),Ye(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body)}).then(r=>Tr(this,void 0,void 0,function*(){var n,s,a;let l=null,o=null,d=null;if(r.ok){let m=(n=this.headers.Prefer)===null||n===void 0?void 0:n.split(",").includes("return=minimal");if(this.method!=="HEAD"&&!m){let D=yield r.text();D&&D!==""&&this.headers.Accept!=="text/csv"&&(o=JSON.parse(D))}let S=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),P=(a=r.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");S&&P&&P.length>1&&(d=parseInt(P[1]))}else l=yield r.json();return{error:l,data:o,count:d,status:r.status,statusText:r.statusText,body:o}})).then(e,t)}},Ne=class extends Me{select(e="*"){let t=!1,r=e.split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this}order(e,{ascending:t=!0,nullsFirst:r=!1,foreignTable:n}={}){let s=typeof n=="undefined"?"order":`${n}.order`,a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${e}.${t?"asc":"desc"}.${r?"nullsfirst":"nullslast"}`),this}limit(e,{foreignTable:t}={}){let r=typeof t=="undefined"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){let n=typeof r=="undefined"?"offset":`${r}.offset`,s=typeof r=="undefined"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(s,`${t-e+1}`),this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){this.headers.Accept="application/vnd.pgrst.object+json";let e=new Ne(this);return e.then=(t,r)=>this.then(n=>{var s;return((s=n.error)===null||s===void 0?void 0:s.details.includes("Results contain 0 rows"))?t({error:null,data:null,count:n.count,status:200,statusText:"OK",body:null}):t(n)},r),e}csv(){return this.headers.Accept="text/csv",this}},se=class extends Ne{constructor(){super(...arguments);this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(e,t,r){return this.url.searchParams.append(`${e}`,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){let r=typeof t=="undefined"?"or":`${t}.or`;return this.url.searchParams.append(r,`(${e})`),this}eq(e,t){return this.url.searchParams.append(`${e}`,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(`${e}`,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(`${e}`,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(`${e}`,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(`${e}`,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(`${e}`,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(`${e}`,`like.${t}`),this}ilike(e,t){return this.url.searchParams.append(`${e}`,`ilike.${t}`),this}is(e,t){return this.url.searchParams.append(`${e}`,`is.${t}`),this}in(e,t){let r=t.map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(`${e}`,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(`${e}`,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(`${e}`,`cs.{${t.join(",")}}`):this.url.searchParams.append(`${e}`,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(`${e}`,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(`${e}`,`cd.{${t.join(",")}}`):this.url.searchParams.append(`${e}`,`cd.${JSON.stringify(t)}`),this}rangeLt(e,t){return this.url.searchParams.append(`${e}`,`sl.${t}`),this}rangeGt(e,t){return this.url.searchParams.append(`${e}`,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(`${e}`,`nxl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(`${e}`,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(`${e}`,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(`${e}`,`ov.${t}`):this.url.searchParams.append(`${e}`,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n=null}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");let a=r===void 0?"":`(${r})`;return this.url.searchParams.append(`${e}`,`${s}fts${a}.${t}`),this}fts(e,t,{config:r}={}){let n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${e}`,`fts${n}.${t}`),this}plfts(e,t,{config:r}={}){let n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${e}`,`plfts${n}.${t}`),this}phfts(e,t,{config:r}={}){let n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${e}`,`phfts${n}.${t}`),this}wfts(e,t,{config:r}={}){let n=typeof r=="undefined"?"":`(${r})`;return this.url.searchParams.append(`${e}`,`wfts${n}.${t}`),this}filter(e,t,r){return this.url.searchParams.append(`${e}`,`${t}.${r}`),this}match(e){return Object.keys(e).forEach(t=>{this.url.searchParams.append(`${t}`,`eq.${e[t]}`)}),this}},Ke=class extends Me{constructor(e,{headers:t={},schema:r}={}){super({});this.url=new URL(e),this.headers=Object.assign({},t),this.schema=r}select(e="*",{head:t=!1,count:r=null}={}){this.method="GET";let n=!1,s=e.split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),t&&(this.method="HEAD"),new se(this)}insert(e,{upsert:t=!1,onConflict:r,returning:n="representation",count:s=null}={}){this.method="POST";let a=[`return=${n}`];if(t&&a.push("resolution=merge-duplicates"),t&&r!==void 0&&this.url.searchParams.set("on_conflict",r),this.body=e,s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),Array.isArray(e)){let l=e.reduce((o,d)=>o.concat(Object.keys(d)),[]);if(l.length>0){let o=[...new Set(l)];this.url.searchParams.set("columns",o.join(","))}}return new se(this)}upsert(e,{onConflict:t,returning:r="representation",count:n=null}={}){this.method="POST";let s=["resolution=merge-duplicates",`return=${r}`];return t!==void 0&&this.url.searchParams.set("on_conflict",t),this.body=e,n&&s.push(`count=${n}`),this.headers.Prefer=s.join(","),new se(this)}update(e,{returning:t="representation",count:r=null}={}){this.method="PATCH";let n=[`return=${t}`];return this.body=e,r&&n.push(`count=${r}`),this.headers.Prefer=n.join(","),new se(this)}delete({returning:e="representation",count:t=null}={}){this.method="DELETE";let r=[`return=${e}`];return t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new se(this)}},ht=class extends Me{constructor(e,{headers:t={},schema:r}={}){super({});this.url=new URL(e),this.headers=Object.assign({},t),this.schema=r}rpc(e,{count:t=null}={}){return this.method="POST",this.body=e,t&&(this.headers.Prefer!==void 0?this.headers.Prefer+=`,count=${t}`:this.headers.Prefer=`count=${t}`),new se(this)}},dt=class{constructor(e,{headers:t={},schema:r}={}){this.url=e,this.headers=t,this.schema=r}auth(e){return this.headers.Authorization=`Bearer ${e}`,this}from(e){let t=`${this.url}/${e}`;return new Ke(t,{headers:this.headers,schema:this.schema})}rpc(e,t,{count:r=null}={}){let n=`${this.url}/rpc/${e}`;return new ht(n,{headers:this.headers,schema:this.schema}).rpc(t,{count:r})}},w;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(w||(w={}));var ft=(i,e,t={})=>{let r={},n=typeof t.skipTypes!="undefined"?t.skipTypes:[];return Object.entries(e).map(([s,a])=>{r[s]=Sr(s,i,e,n)}),r},Sr=(i,e,t,r)=>{let n=e.find(s=>s.name==i);return!n||r.includes(n.type)?V(t[i]):pt(n.type,t[i])},pt=(i,e)=>{try{if(e===null)return null;if(i.charAt(0)==="_"){let t=i.slice(1,i.length);return Or(e,t)}switch(i){case w.abstime:return V(e);case w.bool:return Ar(e);case w.date:return V(e);case w.daterange:return Xe(e);case w.float4:return He(e);case w.float8:return He(e);case w.int2:return Le(e);case w.int4:return Le(e);case w.int4range:return mt(e);case w.int8:return Le(e);case w.int8range:return mt(e);case w.json:return yt(e);case w.jsonb:return yt(e);case w.money:return He(e);case w.numeric:return He(e);case w.oid:return Le(e);case w.reltime:return V(e);case w.time:return V(e);case w.timestamp:return jr(e);case w.timestamptz:return V(e);case w.timetz:return V(e);case w.tsrange:return Xe(e);case w.tstzrange:return Xe(e);default:return V(e)}}catch(t){return console.log(`Could not convert cell of type ${i} and value ${e}`),console.log(`This is the error: ${t}`),e}},V=i=>i,Ar=i=>{switch(i){case"t":return!0;case"f":return!1;default:return null}},Xe=i=>{let e=JSON.parse(i);return[new Date(e[0]),new Date(e[1])]},He=i=>parseFloat(i),Le=i=>parseInt(i),mt=i=>{let e=JSON.parse(i);return[parseInt(e[0]),parseInt(e[1])]},yt=i=>JSON.parse(i),Or=(i,e)=>{let t=i.slice(1,i.length-1);return(t.length>0?t.split(","):[]).map(s=>pt(e,s))},jr=i=>i.replace(" ","T"),Rr="1.0.0",gt=1e4,Cr=1e3,we;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(we||(we={}));var I;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(I||(I={}));var J;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave"})(J||(J={}));var Qe;(function(i){i.websocket="websocket"})(Qe||(Qe={}));var Ve=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}},Fe=class{constructor(e,t,r={},n=gt){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel.trigger(this.refEvent,{status:e,response:t})}_cancelRefEvent(){!this.refEvent||this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}},vt=class{constructor(e,t={},r){this.topic=e,this.params=t,this.socket=r,this.bindings=[],this.state=I.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new Fe(this,J.join,this.params,this.timeout),this.rejoinTimer=new Ve(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=I.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=I.closed,this.socket.remove(this)}),this.onError(n=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=I.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{!this.isJoining()||(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=I.errored,this.rejoinTimer.scheduleTimeout())}),this.on(J.reply,(n,s)=>{this.trigger(this.replyEventName(s),n)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(e=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(e),this.joinPush}onClose(e){this.on(J.close,e)}onError(e){this.on(J.error,t=>e(t))}on(e,t){this.bindings.push({event:e,callback:t})}off(e){this.bindings=this.bindings.filter(t=>t.event!==e)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Fe(this,e,t,r);return this.canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}unsubscribe(e=this.timeout){this.state=I.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(J.close,"leave",this.joinRef())},r=new Fe(this,J.leave,{},e);return r.receive("ok",()=>t()).receive("timeout",()=>t()),r.send(),this.canPush()||r.trigger("ok",{}),r}onMessage(e,t,r){return t}isMember(e){return this.topic===e}joinRef(){return this.joinPush.ref}sendJoin(e){this.state=I.joining,this.joinPush.resend(e)}rejoin(e=this.timeout){this.isLeaving()||this.sendJoin(e)}trigger(e,t,r){let{close:n,error:s,leave:a,join:l}=J;if(r&&[n,s,a,l].indexOf(e)>=0&&r!==this.joinRef())return;let d=this.onMessage(e,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(c=>c.event==="*"?e===(t==null?void 0:t.type):c.event===e).map(c=>c.callback(d,r))}replyEventName(e){return`chan_reply_${e}`}isClosed(){return this.state===I.closed}isErrored(){return this.state===I.errored}isJoined(){return this.state===I.joined}isJoining(){return this.state===I.joining}isLeaving(){return this.state===I.leaving}},bt=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")},Ir=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(i){return bt()}try{return __global__||bt()}finally{delete Object.prototype.__global__}}(),Pr="websocket",Dr="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",Br=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Ur="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",qr=["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Mr="1.0.34",Nr={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Hr="https://github.com/theturtle32/WebSocket-Node",Lr={node:">=4.0.0"},Fr={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Gr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},zr={verbose:!1},Jr={test:"tape test/unit/*.js",gulp:"gulp"},Yr="index",Wr={lib:"./lib"},Kr="lib/browser.js",Xr="Apache-2.0",Qr="https://registry.npmjs.org/websocket/-/websocket-1.0.34.tgz",Vr="sha512-PRDso2sGwF6kM75QykIesBijKSVceR6jL2G8NGYyq2XrItNC2P5/qL5XeR056GhA+Ly7JMFvJb9I312mJfmqnQ==",Zr="websocket@1.0.34",en={name:Pr,description:Dr,keywords:Br,author:Ur,contributors:qr,version:Mr,repository:Nr,homepage:Hr,engines:Lr,dependencies:Fr,devDependencies:Gr,config:zr,scripts:Jr,main:Yr,directories:Wr,browser:Kr,license:Xr,_resolved:Qr,_integrity:Vr,_from:Zr},tn=en.version,oe;if(typeof globalThis=="object")oe=globalThis;else try{oe=Ir}catch(i){}finally{if(!oe&&typeof window!="undefined"&&(oe=window),!oe)throw new Error("Could not determine global this")}var _e=oe.WebSocket||oe.MozWebSocket;function wt(i,e){var t;return e?t=new _e(i,e):t=new _e(i),t}_e&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(i){Object.defineProperty(wt,i,{get:function(){return _e[i]}})});var rn={w3cwebsocket:_e?wt:null,version:tn},nn=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},sn=()=>{},_t=class{constructor(e,t){this.channels=[],this.endPoint="",this.headers={},this.params={},this.timeout=gt,this.transport=rn.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=sn,this.conn=null,this.sendBuffer=[],this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${e}/${Qe.websocket}`,(t==null?void 0:t.params)&&(this.params=t.params),(t==null?void 0:t.headers)&&(this.headers=t.headers),(t==null?void 0:t.timeout)&&(this.timeout=t.timeout),(t==null?void 0:t.logger)&&(this.logger=t.logger),(t==null?void 0:t.transport)&&(this.transport=t.transport),(t==null?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs),(t==null?void 0:t.longpollerTimeout)&&(this.longpollerTimeout=t.longpollerTimeout),this.reconnectAfterMs=(t==null?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=(t==null?void 0:t.encode)?t.encode:(r,n)=>n(JSON.stringify(r)),this.decode=(t==null?void 0:t.decode)?t.decode:(r,n)=>n(JSON.parse(r)),this.reconnectTimer=new Ve(()=>nn(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this.onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){return new Promise((r,n)=>{try{this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t||""):this.conn.close(),this.conn=null),r({error:null,data:!0})}catch(s){r({error:s,data:!1})}})}log(e,t,r){this.logger(e,t,r)}onOpen(e){this.stateChangeCallbacks.open.push(e)}onClose(e){this.stateChangeCallbacks.close.push(e)}onError(e){this.stateChangeCallbacks.error.push(e)}onMessage(e){this.stateChangeCallbacks.message.push(e)}connectionState(){switch(this.conn&&this.conn.readyState){case we.connecting:return"connecting";case we.open:return"open";case we.closing:return"closing";default:return"closed"}}isConnected(){return this.connectionState()==="open"}remove(e){this.channels=this.channels.filter(t=>t.joinRef()!==e.joinRef())}channel(e,t={}){let r=new vt(e,t,this);return this.channels.push(r),r}push(e){let{topic:t,event:r,payload:n,ref:s}=e,a=()=>{this.encode(e,l=>{var o;(o=this.conn)===null||o===void 0||o.send(l)})};this.log("push",`${t} ${r} (${s})`,n),this.isConnected()?a():this.sendBuffer.push(a)}onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:s,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${n} ${a&&"("+a+")"||""}`,s),this.channels.filter(l=>l.isMember(r)).forEach(l=>l.trigger(n,s,a)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Rr}))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e.trigger(J.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(!!this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Cr,"hearbeat timeout");return}this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}},kt=class{constructor(e,t,r){let n=r==="*"?`realtime:${t}`:`realtime:${t}:${r}`;this.subscription=e.channel(n)}getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ft(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ft(e.columns,e.old_record)),t}on(e,t){return this.subscription.on(e,r=>{let n={schema:r.schema,table:r.table,commit_timestamp:r.commit_timestamp,eventType:r.type,new:{},old:{}};n=Object.assign(Object.assign({},n),this.getPayloadRecords(r)),t(n)}),this}subscribe(e=()=>{}){return this.subscription.onError(t=>e("SUBSCRIPTION_ERROR",t)),this.subscription.onClose(()=>e("CLOSED")),this.subscription.subscribe().receive("ok",()=>e("SUBSCRIBED")).receive("error",t=>e("SUBSCRIPTION_ERROR",t)).receive("timeout",()=>e("RETRYING_AFTER_TIMEOUT")),this.subscription}},xt=class extends Ke{constructor(e,{headers:t={},schema:r,realtime:n,table:s}){super(e,{headers:t,schema:r});this._subscription=new kt(n,r,s),this._realtime=n}on(e,t){return this._realtime.isConnected()||this._realtime.connect(),this._subscription.on(e,t)}},ke=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},on=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),an=(i,e)=>{if(typeof i.json!="function")return e(i);i.json().then(t=>e({message:on(t),status:(i==null?void 0:i.status)||500}))},cn=(i,e,t,r)=>{let n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};function Ge(i,e,t,r,n){return ke(this,void 0,void 0,function*(){return new Promise((s,a)=>{Ye(e,cn(i,t,r,n)).then(l=>{if(!l.ok)throw l;return(t==null?void 0:t.noResolveJson)?s(l):l.json()}).then(l=>s(l)).catch(l=>an(l,a))})})}function Ze(i,e,t){return ke(this,void 0,void 0,function*(){return Ge("GET",i,e,t)})}function xe(i,e,t,r){return ke(this,void 0,void 0,function*(){return Ge("POST",i,t,r,e)})}function ln(i,e,t,r){return ke(this,void 0,void 0,function*(){return Ge("PUT",i,t,r,e)})}function $t(i,e,t,r){return ke(this,void 0,void 0,function*(){return Ge("DELETE",i,t,r,e)})}var fe=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},Et=class{constructor(e,t={}){this.url=e,this.headers=t}listBuckets(){return fe(this,void 0,void 0,function*(){try{return{data:yield Ze(`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){return{data:null,error:e}}})}getBucket(e){return fe(this,void 0,void 0,function*(){try{return{data:yield Ze(`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}})}createBucket(e,t={public:!1}){return fe(this,void 0,void 0,function*(){try{return{data:(yield xe(`${this.url}/bucket`,{id:e,name:e,public:t.public},{headers:this.headers})).name,error:null}}catch(r){return{data:null,error:r}}})}updateBucket(e,t){return fe(this,void 0,void 0,function*(){try{return{data:yield ln(`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public},{headers:this.headers}),error:null}}catch(r){return{data:null,error:r}}})}emptyBucket(e){return fe(this,void 0,void 0,function*(){try{return{data:yield xe(`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}})}deleteBucket(e){return fe(this,void 0,void 0,function*(){try{return{data:yield $t(`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}})}},Tt=()=>typeof window!="undefined",ae=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},un={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},St={cacheControl:"3600"},At=class{constructor(e,t={},r){this.url=e,this.headers=t,this.bucketId=r}upload(e,t,r){return ae(this,void 0,void 0,function*(){try{if(!Tt())throw new Error("No browser detected.");let n=new FormData,s=Object.assign(Object.assign({},St),r);n.append("cacheControl",s.cacheControl),n.append("",t,t.name);let a=this._getFinalPath(e),l=yield fetch(`${this.url}/object/${a}`,{method:"POST",body:n,headers:Object.assign({},this.headers)});if(l.ok)return{data:{Key:a},error:null};{let o=yield l.json();return{data:null,error:o}}}catch(n){return{data:null,error:n}}})}update(e,t,r){return ae(this,void 0,void 0,function*(){try{if(!Tt())throw new Error("No browser detected.");let n=new FormData,s=Object.assign(Object.assign({},St),r);n.append("cacheControl",s.cacheControl),n.append("",t,t.name);let a=this._getFinalPath(e),l=yield fetch(`${this.url}/object/${a}`,{method:"PUT",body:n,headers:Object.assign({},this.headers)});if(l.ok)return{data:{Key:a},error:null};{let o=yield l.json();return{data:null,error:o}}}catch(n){return{data:null,error:n}}})}move(e,t){return ae(this,void 0,void 0,function*(){try{return{data:yield xe(`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){return{data:null,error:r}}})}createSignedUrl(e,t){return ae(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield xe(`${this.url}/object/sign/${r}`,{expiresIn:t},{headers:this.headers}),s=`${this.url}${n.signedURL}`;return n={signedURL:s},{data:n,error:null,signedURL:s}}catch(r){return{data:null,error:r,signedURL:null}}})}download(e){return ae(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);return{data:yield(yield Ze(`${this.url}/object/${t}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(t){return{data:null,error:t}}})}getPublicUrl(e){try{let t=this._getFinalPath(e),r=`${this.url}/object/public/${t}`;return{data:{publicURL:r},error:null,publicURL:r}}catch(t){return{data:null,error:t,publicURL:null}}}remove(e){return ae(this,void 0,void 0,function*(){try{return{data:yield $t(`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){return{data:null,error:t}}})}list(e,t,r){return ae(this,void 0,void 0,function*(){try{let n=Object.assign(Object.assign(Object.assign({},un),t),{prefix:e||""});return{data:yield xe(`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){return{data:null,error:n}}})}_getFinalPath(e){return`${this.bucketId}/${e}`}},Ot=class extends Et{constructor(e,t={}){super(e,t)}from(e){return new At(this.url,this.headers,e)}},jt=function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function l(c){try{d(r.next(c))}catch(m){a(m)}}function o(c){try{d(r.throw(c))}catch(m){a(m)}}function d(c){c.done?s(c.value):n(c.value).then(l,o)}d((r=r.apply(i,e||[])).next())})},hn={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,localStorage:globalThis.localStorage,headers:nr},Rt=class{constructor(e,t,r){if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");let n=Object.assign(Object.assign({},hn),r);this.restUrl=`${e}/rest/v1`,this.realtimeUrl=`${e}/realtime/v1`.replace("http","ws"),this.authUrl=`${e}/auth/v1`,this.storageUrl=`${e}/storage/v1`,this.schema=n.schema,this.auth=this._initSupabaseAuthClient(n),this.realtime=this._initRealtimeClient()}get storage(){return new Ot(this.storageUrl,this._getAuthHeaders())}from(e){let t=`${this.restUrl}/${e}`;return new xt(t,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:e})}rpc(e,t){return this._initPostgRESTClient().rpc(e,t)}removeSubscription(e){return new Promise(t=>jt(this,void 0,void 0,function*(){try{yield this._closeSubscription(e);let r=this.getSubscriptions().length;if(!r){let{error:n}=yield this.realtime.disconnect();if(n)return t({error:n})}return t({error:null,data:{openSubscriptions:r}})}catch(r){return t({error:r})}}))}_closeSubscription(e){return jt(this,void 0,void 0,function*(){e.isClosed()||(yield this._closeChannel(e))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,localStorage:n}){return new ut({url:this.authUrl,headers:{Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`},autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,localStorage:n})}_initRealtimeClient(){return new _t(this.realtimeUrl,{params:{apikey:this.supabaseKey}})}_initPostgRESTClient(){return new dt(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema})}_getAuthHeaders(){var e,t;let r={},n=(t=(e=this.auth.session())===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey;return r.apikey=this.supabaseKey,r.Authorization=`Bearer ${n}`,r}_closeChannel(e){return new Promise((t,r)=>{e.unsubscribe().receive("ok",()=>(this.realtime.remove(e),t(!0))).receive("error",n=>r(n))})}},Ct=(i,e,t)=>new Rt(i,e,t);var dn=document.getElementById("fingerprint"),ze=dn.getBoundingClientRect(),Bn=ze.left,Un=ze.top,et=ze.width,fn=ze.height,It=et/1.665,pn=d3.cluster().size([2*Math.PI,It-100]),mn=["#4EA8BA","#4EA8BA","#46AAB3","#7B9FE3","#9A99FF","#65A4CF"],ce=["self-ethicist","others-ethicist","paid work","years in field","education","career path"],yn=["#CB9AC6","#FDCC9A","#B668AA","#D66B6E","#DC9AA2","#8B6BAA","#EB9C84","#CB9AC6"],gn=[0,1,2,3,12,23,13,123],Pt=["topics","domain","outputs","audiences","collab type","collab field"],Dt=d3.scaleOrdinal().domain(ce).range(mn),Bt=d3.scaleOrdinal().domain(gn).range(yn);function tt(i,e){let t;e?t=d3.selectAll(".fingerprint-container").append("svg").attr("width",et).attr("height",fn).append("g").attr("transform","translate("+et/2+","+It/1.2+")"):t=d3.selectAll(".fingerprint-container").selectAll("svg").selectAll("g");let[r,n,s]=i.children,a={...i,children:[r,n]},l=d3.hierarchy(a),o=pn(l);e?t.append("g").attr("fill","none").attr("class","thedraw").selectAll("path").data(o.links()).join("path").attr("class","drawing").attr("stroke-width",function(d){return d.target.data.value!=null&&d.target.data.value<1?1:1.5}).attr("d",d3.linkRadial().angle(function(d){return d.x}).radius(function(d){return d.y})).attr("stroke-opacity",function(d){return d.target.data.value>0?1:.5}).attr("stroke",function(d){if(d.target.data.value>=0){for(let c=0;c<ce.length;c++)if(d.source.data.name==ce[c])return Dt(d.source.data.name);for(let c=0;c<ce.length;c++)if(d.source.data.name==Pt[c])return Bt(d.target.data.value)}else return"lightgrey"}):t.selectAll("g.thedraw").selectAll("path").data(o.links()).join("path").attr("class","drawing").attr("stroke-width",function(d){return d.target.data.value!=null&&d.target.data.value<1?1:1.5}).attr("d",d3.linkRadial().angle(function(d){return d.x}).radius(function(d){return d.y})).attr("stroke-opacity",function(d){return d.target.data.value>0?1:.5}).attr("stroke",function(d){if(d.target.data.value>=0){for(let c=0;c<ce.length;c++)if(d.source.data.name==ce[c])return Dt(d.source.data.name);for(let c=0;c<ce.length;c++)if(d.source.data.name==Pt[c])return Bt(d.target.data.value)}else return"lightgrey"}),t.selectAll("g").selectAll("circle").remove(),t.append("g").selectAll("circle").data(o.descendants()).join("circle").filter(function(d){return d.data.value>0}).attr("transform",d=>`
          rotate(${d.x*180/Math.PI-90})
          translate(${d.y},0)
        `).attr("fill","white").attr("opacity",.7).attr("r",2.5).attr("class",function(d){return d.data.name}),e&&t.append("g").attr("font-size",10).attr("stroke-linejoin","round").attr("stroke-width",3).selectAll("text").data(o.descendants()).join("text").filter(function(d){return d.children}).attr("class","dendroText").attr("transform",d=>`
          rotate(${d.x*180/Math.PI-90})
          translate(${d.y},0) 
          rotate(${d.x>=Math.PI?180:0})
        `).attr("dy","0.31em").attr("x",d=>d.x<Math.PI==!d.children?6:-6).attr("text-anchor",d=>d.x<Math.PI==!d.children?"start":"end").attr("fill",function(d){if(d.children)return"none"}).text(d=>d.data.name).clone(!0).lower()}d3.selectAll(".dendro-labels-on").on("click",function(){d3.selectAll(".dendroText").transition().attr("fill","white")});d3.selectAll(".dendro-labels-off").on("click",function(){d3.selectAll(".dendroText").transition().attr("fill","none")});var vn=document.getElementById("wheel-container"),{width:Y,height:le}=vn.getBoundingClientRect();var $e=d3.select("#tooltip").style("opacity",0);function rt(i,e){d3.select("#wheel-container").selectAll("svg").remove();let t=d3.select("#wheel-container").append("svg").attr("width",Y).attr("height",le).attr("viewBox",[0,0,Y,le]),r=t.append("g"),n=2,s=Y/15,a=le/14,l=Y/2-s*2.2,o=le/n,c=Y/40/2,m=40,S=7.5,P=S*4,D=["#4EA8BA","#4EA8BA","#46AAB3","#7B9FE3","#9A99FF","#65A4CF"],k=["self-ethicist","others-ethicist","paid work","years in field","education","career path"],te=["#CB9AC6","#FDCC9A","#B668AA","#D66B6E","#DC9AA2","#8B6BAA","#EB9C84","#CB9AC6"],ue=[0,1,2,3,12,23,13,123],U=.5,W=.2,he=.2,K=d3.scaleOrdinal().domain(k).range(D),X=d3.scaleOrdinal().domain(ue).range(te),A=[{x:l+s+c*2,y:o-a-c,rot:15,id:"self-ethicist"},{x:l+s-c,y:o-a-c*3,rot:350,id:"others-ethicist"},{x:l+s+c*2,y:o-c,rot:80,id:"paid work"},{x:l-s/2,y:o+a/2-c,rot:180,id:"years in field"},{x:l+s*2,y:o+a,rot:80,id:"education"},{x:l-s/2,y:o-a-c*3,rot:250,id:"career path"}],j=[{x:l+s*3,y:o-a-c*3,rot:300,id:"topics"},{x:l+s*3+c,y:o-a-c,rot:80,id:"domain"},{x:l+s*4.5,y:o+a/2,rot:65,id:"outputs"},{x:l+s*4.9,y:o+a/2+P*1.5,rot:70,id:"audiences"},{x:l+s*4.6,y:o-a-c*4,rot:300,id:"collab type"},{x:l+s*5,y:o-a-c*3,rot:40,id:"collab field"}],M=[A[5],A[1],A[0],A[2],A[4]],me=[j[5],j[4],j[0],j[1],j[2],j[3]],ye=[A[0],j[0]],R=[A[3],A[0]],B=0,N=0,u=[],p=[],g=0,x,_=0,v=d3.scaleLinear().domain([0,g]).range([1,P]),H=52,G=d3.scaleLinear().domain([0,H]).range([0,360]),z=d3.scaleLinear().domain([0,100]).range([5,.5]),q=d3.scaleLinear().domain([2,52]).range([S,m]),E=3,Se=S+2,de=3,Ae=3,Oe=4,je=6,Re=5,Ce=S,O=m/1.8,b=[],ge=8;function Je(h,f=ge){let y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278125,.278125,.35625,.55625,.55625,.890625,.6671875,.1921875,.334375,.334375,.390625,.584375,.278125,.334375,.278125,.303125,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.278125,.278125,.5859375,.584375,.5859375,.55625,1.015625,.6671875,.6671875,.7234375,.7234375,.6671875,.6109375,.778125,.7234375,.278125,.5,.6671875,.55625,.834375,.7234375,.778125,.6671875,.778125,.7234375,.6671875,.6109375,.7234375,.6671875,.9453125,.6671875,.6671875,.6109375,.278125,.35625,.278125,.478125,.55625,.334375,.55625,.55625,.5,.55625,.55625,.278125,.55625,.55625,.2234375,.2421875,.5,.2234375,.834375,.55625,.55625,.55625,.55625,.334375,.5,.278125,.55625,.5,.7234375,.5,.5,.5,.35625,.2609375,.3546875,.590625],re=.5293256578947368;return h.split("").map(C=>C.charCodeAt(0)<y.length?y[C.charCodeAt(0)]:re).reduce((C,rr)=>rr+C)*f}let ve=i.children,Ie=r.selectAll(".gID").data(ve[0].children).join("g").attr("class",function(h,f){return h.name}).attr("transform",function(h,f){if(A[f].id==h.name)return`translate(${A[f].x}, ${A[f].y}), rotate(${A[f].rot},0,0)`}),Tn=Ie.append("circle").attr("class","innerCirc").attr("cx",0).attr("cy",0).attr("r",function(h){return b.push({name:h.name,num:h.children.length}),h.name=="years in field"?O:q(h.children.length)}).attr("fill","none").attr("stroke","lightgrey"),Pe=r.selectAll(".gTHE").data(ve[1].children).join("g").attr("class",function(h){return h.name}).attr("transform",function(h,f){return`translate(${j[f].x}, ${j[f].y}), rotate(${j[f].rot},0,0)`}),Sn=Pe.append("circle").attr("class","innerCircTheme").attr("cx",B).attr("cy",N).attr("r",function(h){return b.push({name:h.name,num:h.children.length}),q(h.children.length)}).attr("fill","none").attr("stroke","lightgrey"),An=Ie.selectAll(".rectMaxID").data(h=>h.children).join("rect").attr("class","rectMaxID").attr("width",function(h,f){return h.q=="years"&&O>0?z(H):E}).attr("x",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return h.q=="years"&&O>0?B+O*Math.sin(0):B+f*Math.sin(0)}).attr("y",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return h.q=="years"&&O>0?N+O*Math.cos(0):N+f*Math.cos(0)}).attr("transform",function(h,f){return h.q=="years"&&O>0?"rotate("+G(f)+", 0, 0)":h.parent=="education"?"rotate("+(180+E*Ae*f)+", 0, 0)":h.parent=="career path"?"rotate("+(180+E*je*f)+", 0, 0)":h.parent=="self-ethicist"||h.parent=="others-ethicist"||h.parent=="paid work"?"rotate("+(180+E*Se*f)+", 0, 0)":"rotate("+(180+E*de*f)+", 0, 0)"}).attr("fill","none").style("stroke-dasharray","1, 4").attr("stroke",function(h){return K(h.parent)}).attr("stroke-width",he).attr("height",P),Qt=Ie.selectAll(".rectID").data(h=>h.children).join("rect").attr("class",function(h,f){return u.push(h.total),"rectID"}).attr("width",function(h,f){return h.q=="years"&&O>0?z(H):E}).attr("fill",function(h){return h.value==1?K(h.parent):"black"}).attr("stroke",function(h){return K(h.parent)}).attr("stroke-width",function(h){return h.value==1?U:W}).attr("x",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return h.q=="years"&&O>0?B+O*Math.sin(0):B+f*Math.sin(0)}).attr("y",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return h.q=="years"&&O>0?N+O*Math.cos(0):N+f*Math.cos(0)}).attr("transform",function(h,f){return h.q=="years"&&O>0?"rotate("+G(f)+", 0, 0)":h.parent=="education"?"rotate("+(180+E*Ae*f)+", 0, 0)":h.parent=="career path"?"rotate("+(180+E*je*f)+", 0, 0)":h.parent=="self-ethicist"||h.parent=="others-ethicist"||h.parent=="paid work"?"rotate("+(180+E*Se*f)+", 0, 0)":"rotate("+(180+E*de*f)+", 0, 0)"}).attr("height",0).on("mouseenter",Zt).on("mouseleave",it);_=d3.max(u);let On=Pe.selectAll(".rectMaxTH").data(h=>h.children).join("rect").attr("class","rectMaxTH").attr("width",function(h,f){return h.q=="years"&&O>0?z(H):E}).attr("fill","none").attr("x",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return B+f*Math.sin(0)}).attr("y",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return B+f*Math.cos(0)}).attr("transform",function(h,f){return h.parent=="collab field"?"rotate("+(180+E*Oe*f)+", 0, 0)":h.parent=="domain"||h.parent=="outputs"||h.parent=="audiences"?"rotate("+(180+E*Re*f)+", 0, 0)":h.parent=="topics"||h.parent=="collab type"?"rotate("+(180+E*Ce*f)+", 0, 0)":"rotate("+(180+E*de*f)+", 0, 0)"}).attr("fill","none").style("stroke-dasharray","1, 4").attr("stroke",function(h){return X(h.value)}).attr("stroke-width",he).attr("height",P),Vt=Pe.selectAll(".rectTHE").data(h=>h.children).join("rect").attr("class",function(h){return p.push(h.total),"rectTHE"}).attr("width",E).attr("stroke",function(h){return X(h.value)}).attr("fill",function(h){return h.value>0?X(h.value):"black"}).attr("x",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return B+f*Math.sin(0)}).attr("y",function(h){let f;for(let y=0;y<b.length;y++)h.parent==b[y].name&&(f=q(b[y].num));return B+f*Math.cos(0)}).attr("transform",function(h,f){return h.parent=="collab field"?"rotate("+(180+E*Oe*f)+", 0, 0)":h.parent=="domain"||h.parent=="outputs"||h.parent=="audiences"?"rotate("+(180+E*Re*f)+", 0, 0)":h.parent=="topics"||h.parent=="collab type"?"rotate("+(180+E*Ce*f)+", 0, 0)":"rotate("+(180+E*de*f)+", 0, 0)"}).attr("height",0).attr("stroke-width",function(h){return h.value>0?U:W}).on("mouseenter",er).on("mouseleave",it);x=d3.max(p),g=ve[2].responses,g>0&&(x>_&&v.domain([0,x]),_>x&&v.domain([0,_]),Qt.transition().duration(4e3).attr("height",function(h,f){return v(h.total)}),Vt.transition().duration(4e3).attr("height",function(h,f){return v(h.total)}));let De=["self-ethicist","others-ethicist","paid work","years in field","education","career path","domain","topics","outputs","audiences","collab type","collab field"],nt=["do you see yourself as an ethicist?","do your colleagues see you as an ethicist?","are you paid for your work on AI/data ethics?","how many years have you been in the field of AI ethics?","which fields are closest to your education or training?","what best describes where you are in your career?","is there a particular domain you look at?","how would you define the broad topic?","what outputs is this work producing?","who is the audience of your work?","do you collaborate with others in this work?","who else is involved in your work on this theme?"];function Zt(h,f){d3.select(this).attr("stroke-width",U*4),$e.transition().duration(200).style("opacity",.9).style("left",h.pageX+"px").style("top",h.pageY-28+"px");let y=[];f.total==1&&y.push("<br/>"+f.total+" respondent chose this answer"),f.total>1&&y.push("<br/>"+f.total+" total respondents chose this answer"),f.total<1&&y.push("No one has chosen this answer so far");let re;for(let C=0;C<De.length;C++)f.parent==De[C]&&(re=nt[C]);y.push("<br/>Question: "+re),f.value>0&&y.push("<br/>This was your answer: "+f.name),f.value==0&&y.push("<br/>This answer: "+f.name),$e.html(y.join(""))}function er(h,f){d3.select(this).attr("stroke-width",U*4),$e.transition().duration(200).style("opacity",.9).style("left",h.pageX+"px").style("top",h.pageY-28+"px");let y=[];f.total==1&&y.push("<br/>"+f.total+" respondent chose this answer"),f.total>1&&y.push("<br/>"+f.total+" total respondents chose this answer"),f.total<1&&y.push("<br/>No one has chosen this answer so far");let re;for(let C=0;C<De.length;C++)f.parent==De[C]&&(re=nt[C]);y.push("<br/>Question: "+re),f.value>0&&y.push("<br/>Your answer was: "+f.name),f.value==0&&y.push("<br/>This answer: "+f.name),f.value>0&&f.value<12&&y.push("<br/>This was your answer for work theme "+f.value),f.value==12&&y.push("<br/>This was your answer for work themes 1 and 2"),f.value==13&&y.push("<br/>This was your answer for work themes 1 and 3"),f.value==23&&y.push("<br/>This was your answer for work themes 2 and 3"),f.value==123&&y.push("<br/>This was your answer for work themes 1, 2 and 3"),$e.html(y.join(""))}function it(h){d3.select(this).attr("stroke-width",function(f){return f.value>0?U:W}),$e.transition().duration(500).style("opacity",0)}let st=d3.zoom().extent([[0,0],[Y,le]]).scaleExtent([1,8]).on("zoom",tr);t.call(st.scaleBy,2.1);function tr({transform:h}){r.attr("transform",h)}function jn(){t.transition().duration(750).call(st.transform,d3.zoomIdentity,d3.zoomTransform(t.node()).invert([Y/2,le/2]))}let Be=d3.line().x(function(h){return h.x}).y(function(h){return h.y}).curve(d3.curveCatmullRom.alpha(0));r.append("path").data([M]).attr("class","lineID").attr("d",Be),r.append("path").data([R]).attr("class","yearID").attr("d",Be),r.append("path").data([me]).attr("class","lineTH").attr("d",Be),r.append("path").data([ye]).attr("class","lineCN").attr("d",Be),d3.selectAll(".lineID, .yearID, .lineTH, .lineCN").attr("fill","none").attr("stroke","lightgrey").style("stroke-dasharray","1,4").style("stroke-width",.5),d3.selectAll(".innerCirc, .innerCircTheme").attr("stroke-width",.3);let Rn=Ie.append("text").attr("class","idText").attr("font-size",ge).attr("x",0).attr("y",2).attr("text-anchor","middle").attr("transform",function(h,f){return`rotate(${-A[f].rot},0,0)`}).attr("fill","none").text(function(h,f){return 1+f}),Cn=Pe.append("text").attr("class","themeText").attr("font-size",ge).attr("x",0).attr("y",2).attr("text-anchor","middle").attr("transform",function(h,f){return`rotate(${-j[f].rot},0,0)`}).attr("fill","none").text(function(h,f){return 7+f}),In=t.append("image").attr("class","key").attr("x",Y/15).attr("y",le-270).attr("width",Y-Y/15).attr("height",0).attr("xlink:href","img/wheel-key-spread.svg");d3.select("#self-highlight-off").on("click",function(){d3.selectAll(".rectID, .rectTHE").transition().attr("fill","black").transition().attr("stroke-width",U)}),d3.select("#self-highlight-on").on("click",function(){d3.selectAll(".rectID").transition().attr("fill",function(h){return h.value==1?K(h.parent):"black"}).transition().attr("stroke-width",function(h){return h.value==1?U:W}),d3.selectAll(".rectTHE").transition().attr("fill",function(h){return h.value>0?X(h.value):"black"}).transition().attr("stroke-width",function(h){return h.value>0?U:W})}),d3.select("#wheels-labels-on").on("click",function(){d3.selectAll(".lineID, .yearID, .lineTH, .lineCN").attr("opacity",.1),d3.selectAll(".innerCirc, .innerCircTheme").attr("opacity",.1),d3.selectAll(".rectID, .rectTHE").attr("opacity",".3"),d3.selectAll(".idText, .themeText").attr("fill","white"),d3.select(".key").transition().attr("height",300)}),d3.select("#wheels-labels-off").on("click",function(){d3.selectAll(".rectID, .rectTHE").attr("opacity","1"),d3.selectAll(".lineID, .yearID, .lineTH, .lineCN").attr("opacity",".3"),d3.selectAll(".innerCirc, .innerCircTheme").attr("opacity",.5),d3.selectAll(".idText, .themeText").attr("fill","none"),d3.select(".key").transition().attr("height",0)})}var Ee=i=>e=>{if(e===null||e==="")return Object.keys(i).reduce((t,r)=>({...t,[r]:-1}),{});{let t={[e]:1};return{...i,...t}}},bn=i=>e=>{if((e||[]).length===0)return Object.keys(i).reduce((t,r)=>({...t,[r]:-1}),{});{let t=e.reduce((r,n)=>({...r,[n]:1}),{});return{...i,...t}}},Te=i=>(e,t,r)=>{if((e||[]).length===0&&(t||[]).length===0&&(r||[]).length===0)return Object.keys(i).reduce((n,s)=>({...n,[s]:-1}),{});{let n={};return e.length>0&&e.map(s=>{n={...n,[s]:1}}),t.length>0&&t.map(s=>{n.hasOwnProperty(s)?n={...n,[s]:parseInt(`${n[s]}2`,10)}:n={...n,[s]:2}}),r.length>0&&r.map(s=>{n.hasOwnProperty(s)?n={...n,[s]:parseInt(`${n[s]}3`,10)}:n={...n,[s]:3}}),{...i,...n}}},wn=i=>(e,t,r)=>{if((e===null||e==="")&&(t===null||t==="")&&(r===null||r===""))return Object.keys(i).reduce((n,s)=>({...n,[s]:-1}),{});{let n={};return e!==null&&e!==""&&(n={...n,[e]:1}),t!==null&&t!==""&&(n.hasOwnProperty(t)?n={...n,[t]:parseInt(`${n[t]}2`,10)}:n={...n,[t]:2}),r!==null&&r!==""&&(n.hasOwnProperty(r)?n={...n,[r]:parseInt(`${n[r]}3`,10)}:n={...n,[r]:3}),{...i,...n}}};function Ut(i,e){let r=Ee({Yes:0,No:0})(i.q70),n={q:"do you identify as an ethicist?",parent:"self-ethicist"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l]}function qt(i,e){let r=Ee({Yes:0,No:0})(i.q71),n={q:"do others identify you as an ethicist?",parent:"others-ethicist"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l]}function Mt(i,e){let r=Ee({Yes:0,No:0})(i.q14),n={q:"are you paid for your work on AI/data ethics?",parent:"paid work"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l]}function Nt(i,e){let r=Ee({1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,"50+":0})(i.q7),n={q:"years",parent:"years in field"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l]}function Ht(i,e){let r=bn({"#agriculture":0,"#architecture":0,"#biology":0,"#business":0,"#computer science":0,"#data science":0,"#design & art":0,"#economics":0,"#education":0,"#engineering & technology":0,"#health":0,"#history":0,"#information management":0,"#languages":0,"#law":0,"#mathematics":0,"#media":0,"#environmental science":0,"#politics":0,"#psychology":0,"#philosophy":0,"#social sciences":0,"#sports":0,"#other":0})(i.q9),n={q:"education",parent:"education"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l].map(o=>({...o,name:o.name.replace("#","")}))}function Lt(i,e){let r=Ee({"Undergraduate student":0,"Masters student":0,"PhD student":0,Postdoc:0,"University faculty":0,"Industry employee":0,"Government employee":0,"Non-profit employee":0,"Other: (please describe below)":0})(i.q65),n={q:"career",parent:"career path"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l].map(o=>({...o,name:o.name==="Other: (please describe below)"?"Other":o.name}))}function Ft(i,e){let r=Te({"#bias":0,"#fairness":0,"#accountability":0,"#transparency":0,"#explainability":0,other:0})(i.q30,i.q133,i.q149),n={q:"topic",parent:"topics"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l].map(o=>({...o,name:o.name.replace("#","")}))}function Gt(i,e){let r=Te({health:0,finance:0,"urban dynamics":0,transport:0,military:0,"social media":0,"welfare and social care":0,policing:0,"judicial system":0,accessibility:0,education:0,other:0,"N/A":0})(i.q33,i.q139,i.q155),n={q:"domain",parent:"domain"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l]}function zt(i,e){let r=Te({"#academic papers":0,"#reports":0,"#policy-papers":0,"#policy briefing":0,"#blog posts":0,"#exhibitions":0,"#events":0,"#datasets":0,"#website":0,"#code repository":0,"#software application":0,"#other":0})(i.q37,i.q143,i.q159),n={q:"output",parent:"outputs"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l].map(o=>({...o,name:o.name.replace("#","")}))}function Jt(i,e){let r=Te({"#internal audience":0,"#academics":0,"#think tanks":0,"#NGOs":0,"#government institutions":0,"#artists":0,"#designers":0,"#industry":0,"#community organizations":0,"#general public":0,"#other":0})(i.q51,i.q144,i.q160),n={q:"audience",parent:"audiences"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l].map(o=>({...o,name:o.name.replace("#","")}))}function Yt(i,e){let r=wn({"Yes, within my organization":0,"Yes, with others outside my organization":0,"Yes, both within and outside my organization":0,No:0})(i.q35,i.q141,i.q157),n={q:"collab type?",parent:"collab type"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l]}function Wt(i,e){let r=Te({"Researchers - Social Science":0,"Researchers - Humanities":0,"Researchers - Law":0,"Researchers - Medicine":0,"Researchers - Science":0,"Artists and creative practitioners":0,"Computer/Data Scientists":0,"Tech developers and Engineers":0,"General public":0,Regulators:0,NGOs:0,"Affected individuals":0,"Government officials":0,"Community organizations":0,"Industry representatives":0,"Others:":0})(i.q36,i.q142,i.q158),n={q:"collab field?",parent:"collab field"},s=Object.keys(r),a=e.map(({answer:o,count:d})=>{let c=r[o];if(typeof c=="undefined")throw new Error(`Missing value type, make sure to add all possible values. value searched: (${o})`);return s=s.filter(m=>m!==o),{...n,value:c,name:o,total:d}}),l=s.map(o=>({...n,value:r[o],name:o,total:0}));return[...a,...l].map(o=>({...o,name:o.name==="Others:"?"Other":o.name}))}var _n="https://qqvziidjcugzwycwavta.supabase.co",kn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyMzY2NTk5NSwiZXhwIjoxOTM5MjQxOTk1fQ.L4M9hdUoYh3gPHKH0P4-QErYOBOL8R2eggSeNBAHTTY",T=Ct(_n,kn),Z=!0,Kt=new URLSearchParams(document.location.search.substring(1)),xn=()=>{let i=Kt.get("email");return i&&i!=="undefined"&&i!=="null"?decodeURIComponent(i):!1},$n=()=>{let i=Kt.get("id");return i&&i!=="undefined"&&i!=="null"?decodeURIComponent(i):!1},ee=xn(),pe=$n();ee||pe||(Z=!1);var En=async()=>{let{error:i,count:e}=await T.from("data").select("id",{count:"exact"}),t=s=>{let a=document.getElementsByClassName("error-msg");for(let l of a)l.hidden=!0;Xt(s.new).then(l=>(tt(l,Z),l)).then(l=>(rt(l,Z),Z||(Z=!1),l)).catch(console.error)},r=ee||pe?ee?T.from(`data:email=eq.${ee}`).on("INSERT",t).subscribe():T.from(`data:response_id=eq.${pe}`).on("INSERT",t).subscribe():T.from("data").on("INSERT",t).subscribe(),n=ee||pe?!1:await fetch("./data/data.json").then(s=>s.json()).catch(s=>"ignore");if(!n||n.children[2].responses!==e){let s=ee||pe?ee?T.from("data").select().eq("email",ee).limit(1).single():T.from("data").select().eq("response_id",pe).limit(1).single():T.from("data").select().order("created_time",{ascending:!1}).limit(1).single(),{data:a,error:l}=await s;if(l){if(l.message==="JSON object requested, multiple (or no) rows returned"){let o=document.getElementsByClassName("error-msg");for(let d of o)d.innerHTML=`<div class="row">
                            <p class="col-12" >Weâre taking all of your responses into account :)</p>
                            <i class="col-12 spin bi bi-arrow-repeat"></i>
                            <p class="col-12" >Hang on a minute until we show you the result.</p>
                           </div>`}console.error(l);return}Xt(a).then(o=>(tt(o,Z),o)).then(o=>(rt(o,Z),Z=!1,o)).catch(console.error)}window.addEventListener("beforeunload",function(s){return T.removeSubscription(r),s})},Xt=async(i,e)=>{let t=T.from("group_by_70").select(),r=T.from("group_by_71").select(),n=T.from("group_by_65").select(),s=T.from("group_by_14").select(),a=T.from("group_by_7").select(),l=T.from("group_by_9").select(),o=T.from("group_by_30_133_149").select(),d=T.from("group_by_33_139_155").select(),c=T.from("group_by_37_143_159").select(),m=T.from("group_by_51_144_160").select(),S=T.from("group_by_35_141_157").select(),P=T.from("group_by_36_142_158").select(),D=e;if(!D){let{error:Je,count:ve}=await T.from("data").select("id",{count:"exact"});if(Je){console.error(`API-ERROR:
`,Je);return}D=ve}let{data:k,error:te}=await t,{data:ue,error:U}=await r,{data:W,error:he}=await n,{data:K,error:X}=await s,{data:A,error:j}=await a,{data:M,error:me}=await l,{data:ye,error:R}=await o,{data:B,error:N}=await d,{data:u,error:p}=await c,{data:g,error:x}=await m,{data:_,error:v}=await S,{data:H,error:G}=await P,z=te||U||he||X||j||me||R||N||p||x||v||G;if(z){console.error(`API-ERROR:
`,z);return}let q=Ut(i,k),E=qt(i,ue),Se=Mt(i,K),de=Nt(i,A),Ae=Ht(i,M),Oe=Lt(i,W),je=Ft(i,ye),Re=Gt(i,B),Ce=zt(i,u),O=Jt(i,g),b=Yt(i,_),ge=Wt(i,H);return{name:"",children:[{name:"identity",children:[{name:"self-ethicist",children:q},{name:"others-ethicist",children:E},{name:"paid work",children:Se},{name:"years in field",children:de},{name:"education",children:Ae},{name:"career path",children:Oe}]},{name:"theme",children:[{name:"topics",children:je},{name:"domain",children:Re},{name:"outputs",children:Ce},{name:"audiences",children:O},{name:"collab type",children:b},{name:"collab field",children:ge}]},{responses:D}]}};En().catch(console.error);window.innerWidth<768&&$("#sizeModal").modal("toggle");
//# sourceMappingURL=main.js.map
